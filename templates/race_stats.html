{% extends 'base.html' %}

{% block title %}Race #{{ race.pk}} Stats - {{ block.super }}{% endblock %}

{% block content %}
    <div class="generic-wrapper">
        <h2>Race #{{ race.pk}} Stats</h2>

        <div id="podium">
            {% with race.get_first_place as first_place %}
                {% if first_place %}
                <div id="first-place">
                    <img src="http://www.gravatar.com/avatar/{{ first_place.user.gravatar_id }}" alt="{{ first_place.user.name }}" class="gravatar-image">
                    <div>
                        <div class="big-first">1st</div>
                        <div><a href="{{ first_place.user.get_absolute_url }}">{{ first_place.user.name }}</a></div>
                    </div>
                </div>
                {% endif %}
            {% endwith %}
            {% with race.get_second_place as second_place %}
                {% if second_place %}
                <div id="second-place">
                    <img src="http://www.gravatar.com/avatar/{{ second_place.user.gravatar_id }}" alt="{{ second_place.user.name }}" class="gravatar-image">
                    <div>
                        <div class="big-second">2nd</div>
                        <div><a href="{{ second_place.user.get_absolute_url }}">{{ second_place.user.name }}</a></div>
                    </div>
                </div>
                {% endif %}
            {% endwith %}
            {% with race.get_third_place as third_place %}
                {% if third_place %}
                <div id="third-place">
                    <img src="http://www.gravatar.com/avatar/{{ third_place.user.gravatar_id }}" alt="{{ third_place.user.name }}" class="gravatar-image">
                    <div>
                        <div class="big-third">3rd</div>
                        <div><a href="{{ third_place.user.get_absolute_url }}">{{ third_place.user.name }}</a></div>
                    </div>
                </div>
                {% endif %}
            {% endwith %}
        </div>

        <div>
            <h3>Match Breakdown</h3>

            <table>
                <thead>
                    <tr>
                        <th>Player</th>
                        {% with race.question_set.all as questions %}
                        {% for question in questions %}
                        <td>{{ forloop.counter }}</td>
                        {% endfor %}
                        {% endwith %}
                    </tr>
                </thead>
                <tbody>
                    {% with race.results as results %}
                    {% for outcome in results %}
                    <tr>
                        <th>
                            <a href="{{ outcome.user.get_absolute_url }}">{{ outcome.user.name }}</a>
                        </th>
                        {% for answer in outcome.answers %}
                            <td>{{ answer.time_taken }}</td>
                        {% endfor %}
                    </tr>
                    {% endfor %}
                    {% endwith %}
                </tbody>
            </table>
        </div>
    </div>
{% endblock %}
